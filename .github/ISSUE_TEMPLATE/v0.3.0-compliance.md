---
name: A2A Protocol v0.3.0 Specification Compliance
about: Track implementation of v0.3.0 spec features
title: 'Implement A2A Protocol v0.3.0 Specification Features'
labels: enhancement, spec-compliance, security
assignees: ''
---

## Overview

This issue tracks the implementation of breaking changes and new features introduced in [A2A Protocol v0.3.0](https://github.com/a2aproject/A2A/releases/tag/v0.3.0) (released July 30, 2025).

**Current Status:** The a2a-rs implementation is 100% compliant with v0.2.x but missing 6 v0.3.0 features.

**Overall v0.3.0 Compliance:** 40% (4/10 new features implemented)

---

## üîí Priority 1: Security Features (High Impact)

### 1. Add AgentCard Signature Support
**Impact:** High - Essential for production security and card integrity verification

**What's needed:**
- Add `signature` field to `AgentCard` struct
- Implement `AgentCardSignature` type per RFC 7515 (JSON Web Signature)
- Add JWS verification logic

**Implementation:**
```rust
// File: a2a-rs/src/domain/core/agent.rs

/// JSON Web Signature for AgentCard integrity verification (RFC 7515)
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct AgentCardSignature {
    /// Base64url-encoded protected JWS header
    pub protected: String,
    /// Base64url-encoded signature
    pub signature: String,
    /// Optional unprotected JWS header values
    #[serde(skip_serializing_if = "Option::is_none")]
    pub header: Option<HashMap<String, serde_json::Value>>,
}

// Update AgentCard struct (line ~219)
#[derive(Debug, Clone, Serialize, Deserialize, Builder)]
pub struct AgentCard {
    // ... existing fields ...

    #[serde(skip_serializing_if = "Option::is_none")]
    pub signature: Option<AgentCardSignature>,
}
```

**Acceptance Criteria:**
- [ ] `AgentCardSignature` struct implemented with RFC 7515 compliance
- [ ] `signature` field added to `AgentCard` as optional
- [ ] Signature verification method implemented (optional feature flag)
- [ ] Tests for signature validation
- [ ] Documentation updated

**Related Spec:** [RFC 7515 - JSON Web Signature](https://tools.ietf.org/html/rfc7515)

---

### 2. Add mTLS Security Scheme
**Impact:** High - Enterprise requirement for zero-trust architectures

**What's needed:**
- Add `MutualTls` variant to `SecurityScheme` enum
- Support mTLS in authentication flows

**Implementation:**
```rust
// File: a2a-rs/src/domain/core/agent.rs (line ~23)

#[derive(Debug, Clone, Serialize, Deserialize)]
#[serde(tag = "type", rename_all = "camelCase")]
pub enum SecurityScheme {
    #[serde(rename = "apiKey")]
    ApiKey {
        #[serde(rename = "in")]
        location: String,
        name: String,
        #[serde(skip_serializing_if = "Option::is_none")]
        description: Option<String>,
    },
    #[serde(rename = "http")]
    Http {
        scheme: String,
        #[serde(skip_serializing_if = "Option::is_none", rename = "bearerFormat")]
        bearer_format: Option<String>,
        #[serde(skip_serializing_if = "Option::is_none")]
        description: Option<String>,
    },
    #[serde(rename = "oauth2")]
    OAuth2 {
        flows: Box<OAuthFlows>,
        #[serde(skip_serializing_if = "Option::is_none")]
        description: Option<String>,
    },
    #[serde(rename = "openIdConnect")]
    OpenIdConnect {
        #[serde(rename = "openIdConnectUrl")]
        open_id_connect_url: String,
        #[serde(skip_serializing_if = "Option::is_none")]
        description: Option<String>,
    },
    // NEW: mTLS support
    #[serde(rename = "mutualTls")]
    MutualTls {
        #[serde(skip_serializing_if = "Option::is_none")]
        description: Option<String>,
    },
}
```

**Acceptance Criteria:**
- [ ] `MutualTls` variant added to `SecurityScheme` enum
- [ ] Serialization/deserialization tests for mTLS scheme
- [ ] Documentation on mTLS configuration
- [ ] Example agent using mTLS authentication

**Related Spec:** [A2A v0.3.0 Security Schemes](https://a2a-protocol.org/latest/specification/#security)

---

## üìã Priority 2: Compliance Features (Medium Impact)

### 3. Add OAuth2 Metadata URL Field
**Impact:** Medium - OAuth2 discovery improvement

**What's needed:**
- Add optional `metadataUrl` field to `OAuth2` security scheme
- Support RFC 8414 OAuth2 Authorization Server Metadata

**Implementation:**
```rust
// File: a2a-rs/src/domain/core/agent.rs (line ~40)

#[serde(rename = "oauth2")]
OAuth2 {
    flows: Box<OAuthFlows>,
    #[serde(skip_serializing_if = "Option::is_none")]
    description: Option<String>,
    // NEW: OAuth2 metadata discovery endpoint
    #[serde(skip_serializing_if = "Option::is_none", rename = "metadataUrl")]
    metadata_url: Option<String>,
},
```

**Acceptance Criteria:**
- [ ] `metadata_url` field added to `OAuth2` variant
- [ ] Field properly serialized/deserialized with camelCase
- [ ] Tests for OAuth2 scheme with metadata URL
- [ ] Documentation updated with RFC 8414 reference

**Related Spec:** [RFC 8414 - OAuth 2.0 Authorization Server Metadata](https://tools.ietf.org/html/rfc8414)

---

### 4. Add Per-Skill Security Requirements
**Impact:** Medium - Allow skills to specify their own auth requirements

**What's needed:**
- Add `security` field to `AgentSkill` struct
- Support skill-level authentication overrides

**Implementation:**
```rust
// File: a2a-rs/src/domain/core/agent.rs (line ~150)

#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct AgentSkill {
    pub id: String,
    pub name: String,
    pub description: String,
    pub tags: Vec<String>,
    #[serde(skip_serializing_if = "Option::is_none")]
    pub examples: Option<Vec<String>>,
    #[serde(skip_serializing_if = "Option::is_none", rename = "inputModes")]
    pub input_modes: Option<Vec<String>>,
    #[serde(skip_serializing_if = "Option::is_none", rename = "outputModes")]
    pub output_modes: Option<Vec<String>>,
    // NEW: Per-skill security requirements
    #[serde(skip_serializing_if = "Option::is_none")]
    pub security: Option<Vec<HashMap<String, Vec<String>>>>,
}
```

**Update builder methods:**
```rust
impl AgentSkill {
    // Add new builder method
    pub fn with_security(mut self, security: Vec<HashMap<String, Vec<String>>>) -> Self {
        self.security = Some(security);
        self
    }
}
```

**Acceptance Criteria:**
- [ ] `security` field added to `AgentSkill` struct
- [ ] Builder method `with_security()` implemented
- [ ] Tests for skill-level security requirements
- [ ] Example showing skill with specific auth requirements
- [ ] Documentation explaining security inheritance

---

### 5. Update Well-Known URI Endpoint
**Impact:** Low-Medium - Proper discovery convention per IANA standards

**Current:** `/agent-card` endpoint exists
**Spec requires:** `/.well-known/agent-card.json` (changed from `agent.json`)

**Implementation:**
```rust
// File: a2a-rs/src/adapter/transport/http/server.rs (line ~90)

let mut app = Router::new()
    .route("/", post(handle_request))
    // NEW: Standard well-known URI per RFC 8615 and v0.3.0 spec
    .route("/.well-known/agent-card.json", get(handle_agent_card))
    // KEEP: Backward compatibility
    .route("/agent-card", get(handle_agent_card))
    .route("/.well-known/agent.json", get(handle_agent_card)) // v0.2.x compat
    .route("/skills", get(handle_skills))
    .route("/skills/{id}", get(handle_skill_by_id))
    .with_state(ServerState {
        // ...
    });
```

**Acceptance Criteria:**
- [ ] `/.well-known/agent-card.json` route added
- [ ] Keep `/agent-card` for backward compatibility
- [ ] Keep `/.well-known/agent.json` for v0.2.x compatibility
- [ ] Tests for all three endpoints
- [ ] Documentation updated with correct discovery endpoint
- [ ] Examples updated to use new well-known URI

**Related Spec:**
- [RFC 8615 - Well-Known URIs](https://tools.ietf.org/html/rfc8615)
- [A2A v0.3.0 Breaking Changes](https://github.com/a2aproject/A2A/releases/tag/v0.3.0)

---

## üéØ Priority 3: Advanced Features (Low Impact)

### 6. Implement agent/getExtendedCard Method
**Impact:** Low - Advanced feature for authenticated clients

**Current state:**
- ‚úÖ `supports_authenticated_extended_card` field exists in `AgentCard`
- ‚ùå No `agent/getExtendedCard` RPC method implemented

**What's needed:**
- New JSON-RPC method: `agent/getExtendedCard`
- Handler to return extended `AgentCard` with sensitive information
- Authentication validation before returning extended card

**Implementation:**
```rust
// File: a2a-rs/src/application/handlers/agent.rs (NEW FILE)

use crate::domain::core::agent::AgentCard;
use crate::domain::protocols::json_rpc::{JSONRPCRequest, JSONRPCResponse};
use crate::port::agent_info_provider::AsyncAgentInfoProvider;
use crate::port::authenticator::Authenticator;

/// Handler for agent/getExtendedCard method
pub async fn handle_get_extended_card<A, P>(
    request: JSONRPCRequest,
    agent_info: &P,
    authenticator: &A,
) -> Result<JSONRPCResponse, crate::domain::error::A2AError>
where
    A: Authenticator + Send + Sync,
    P: AsyncAgentInfoProvider + Send + Sync,
{
    // 1. Validate authentication
    // 2. Check if agent supports extended card
    // 3. Return extended AgentCard with sensitive info

    todo!("Implement extended card handler")
}
```

**Router update:**
```rust
// File: a2a-rs/src/application/json_rpc.rs

pub enum A2ARequest {
    SendMessage(SendMessageRequest),
    SendStreamingMessage(SendStreamingMessageRequest),
    GetTask(GetTaskRequest),
    CancelTask(CancelTaskRequest),
    SetTaskPushNotification(SetTaskPushNotificationConfigRequest),
    GetTaskPushNotification(GetTaskPushNotificationConfigRequest),
    TaskResubscription(TaskResubscriptionRequest),
    // NEW: Extended card method
    GetExtendedCard(GetExtendedCardRequest),
}
```

**Acceptance Criteria:**
- [ ] `agent/getExtendedCard` JSON-RPC method defined
- [ ] Request/response types implemented
- [ ] Handler with authentication validation
- [ ] Extended card returned only to authenticated clients
- [ ] Tests for authenticated and unauthenticated access
- [ ] Documentation and examples

---

## üìö Additional Tasks

### Documentation
- [ ] Update main README with v0.3.0 compliance status
- [ ] Add v0.3.0 migration guide
- [ ] Update spec/README.md with v0.3.0 references
- [ ] Add examples demonstrating new features

### Testing
- [ ] Integration tests for all new features
- [ ] Backward compatibility tests (v0.2.x clients)
- [ ] Test against A2A TCK if available
- [ ] Update test fixtures with v0.3.0 structures

### CI/CD
- [ ] Update CI to test v0.3.0 compliance
- [ ] Add feature flags for optional v0.3.0 features
- [ ] Version bump to indicate v0.3.0 support

---

## üîó References

- [A2A v0.3.0 Release Notes](https://github.com/a2aproject/A2A/releases/tag/v0.3.0)
- [A2A Protocol Specification](https://a2a-protocol.org/latest/specification/)
- [A2A GitHub Repository](https://github.com/a2aproject/A2A)
- [RFC 7515 - JSON Web Signature](https://tools.ietf.org/html/rfc7515)
- [RFC 8414 - OAuth 2.0 Authorization Server Metadata](https://tools.ietf.org/html/rfc8414)
- [RFC 8615 - Well-Known URIs](https://tools.ietf.org/html/rfc8615)

---

## üìä Implementation Checklist

### Phase 1: Security (v0.4.0)
- [ ] #1 - AgentCard Signature Support
- [ ] #2 - mTLS Security Scheme
- [ ] Tests and documentation for Phase 1

### Phase 2: Compliance (v0.5.0)
- [ ] #3 - OAuth2 Metadata URL
- [ ] #4 - Per-Skill Security
- [ ] #5 - Well-Known URI Update
- [ ] Tests and documentation for Phase 2

### Phase 3: Advanced Features (v0.6.0)
- [ ] #6 - agent/getExtendedCard Method
- [ ] Full v0.3.0 compliance verification
- [ ] Update documentation to reflect full compliance

---

## üí° Notes

- All changes are **backward compatible** with v0.2.x
- Fields are added as `Option<T>` to maintain compatibility
- Consider feature flags for optional security features
- v0.3.0 breaking changes are mainly additive (new fields/methods)
